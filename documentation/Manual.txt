UWBRC Qiime Pipeline Manual
Andrew Bange
aab233@cornell.edu
Last Revision 6/20/2013

This document is a condensed version of the design document. Most of it's contents are taken from there. 

INPUTS
The pipeline takes the following inputs:
 Input directory (-i, --input-dir) A directory containing all the .bam files specified in the map file
 Output directory (-o, --output-dir) The destination directory for the output files and folders.
 Map file (-m, --map) A map file containing all the metadata for each sample. See section on the map file details.
 Number of cores (-c, --cores) The number of cores to use for the parallelized portions of the analysis.
 Minimum read length (-l, --length) The minimum length (in bp) of reads to pass quality filtering.
 Quality threshold (-q, --quality) The minimum quality threashold of reads to pass filtering.
 Reference database (-r, --reference) Optional. A reference database for OTU clustering. Should be in fasta format.
 Sort parameter (-s, --sort) Optional. What criteria (in the mapping file header) to sort the samples on for output. Defaults to sampleID


OUTPUTS

arare: 
Alpha Rarefaction. The easily visualized data is under the folder alpha_rarefaction_plots/rarefaction_plots.html
This is a measure of species richness within each sample. A good data set forms a horizontal asymptote as you increase 
the number of samples measured (the x axis) this means that you aren't getting more diversity by looking at more data
which means your data is representitive of the microbial community as a whole. 
Two useful applications of this data are:
1) Confirming that you have enough data to represent the community as a whole
2) Comparing the overall diversity in two or more samples


bdiv:
Beta diversity. This compares the diversity between samples using unifrac. To visualize the 3d plots, go into the 3d folder,
enter (without single quotes): 'java -jar jar/king.jar <other_folder_with_a_bunch_of_random_letters>/<file_in_there>.jar '
This is a principle coordinate analysis


otus:
taxa_summary
 This contains a summary of the identified taxa in the samples. The visualization data is under taxa_summary_plots.
 The area_charts.html and bar_charts.html contain all the data in a very pretty format. The otu_table.txt files
 contain taxonomy assignments for different levels of depth in tab-delimited format. These are easy to import into excel
 for analysis. 
heatmap
 A heatmap of all identified taxa.
 Be careful when opening it. If you set the threshold too low, it can take firefox 5-10 minutes to load the heatmap. 
network
 An OTU relation network formatted for visualization in cytoscape.
 This can be helpful for small datasets but with larger datasets, it just looks like a giant hairball
rep_set.tre
 A phylogenetic tree that can be visualized with a tree visualization program. 
 I recommend dendroscope for tree visualization (installed under /mnt/software/Dendroscope) 
 The main problem with this which I haven't been able to fix yet is that the nodes are labeled by OTU ID instead of taxon name


MAP FILE

The mapping file is a tab-delimited file containing metadata about each sample. It is very pickey about formatting though.
The first line of the mapping file must be a comment header beginning with a pound '#' as in this example
#SampleID       BarcodeSequence LinkerPrimerSequence    groupID Treatment       Filename        ReversePrimer   Description
This specifies which columns represent what data.
 The first column must be SampleID
 The second file must be BarcodeSequence
 The third column but me LinkerPrimerSequence
subsuquent columns can be in any order but must contain:
 Filename - the name of the .bam file containing this sample
 ReversePrimer - the reverse primer sequence
The last column must be Description

No entry can be left blank. If there isn't data for a specific sample put NA in for the field.
Be careful of whitespace and copy-paste. Spaces will wreck the formatting and copy-paste in the terminal replaces tabs with spaces.
If you're using vim. Type ':set list' as a command to show all tabs as '^I'. The map file
should contain no spaces only ^I when you use set list. Type ':set nolist' to turn this feature off when done.

An example mapping file is included in /mnt/software/qiime/my_scripts/qiime_pipeline/examples










