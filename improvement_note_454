Improvement Note of Qiime Pipeline
Fenglei Jiang
9/19/2013

Pipeline Name: qiime_pipeline_jiang_fna.py
Directory: /mnt/grl/brc/application/qiime_pipeline_jiang/pipeline_454denoising/

This pipeline is a truncated version of the original qiime_pipeline.py located in /mnt/grl/brc/application/qiime_pipeline/, which only calls run_qiime.py. It takes .fna files from demultiplexed, denoised and quality-filtered 454 data. Also, few problems in the original pipeline have been fixed.

The changes are described below:

1. The following lines were removed:
os.system(os.path.join(script_path, "bam_to_fastq.py") + " -- -i " + self.input + " -o " + self.output + " -m " + self.map)
      os.system(os.path.join(script_path, "trim_primers.py") + " -- -i " + self.output + "/fastq/ -o " + self.output + "/trimmed_fastq/ -l " + self.length + " -q " + self.quality + " -m " + self.map)

2. The lines and strings related to "-l --length" and "-q --quality" were removed.

3. The "print_help()" function was changed to "self.print_help()". Also the line of "if self.input is None or self.output is None or self.map is None or self.quality is None or self.length is None:" was changed to "if self.help is False and (self.input is None or self.output is None or self.map is None or self.quality is None or self.length is None):". These changes make -h --help option work properly.

4. The help message was changed accordingly. Typos were corrected

5. The "script_path" was changed accordingly.

6. In the run_qiime.py under the same directory, a few lines were added to get the even sampling parameter "-e" for computing beta diversity:

import math
    for item in open (self.out + "/otus/library_stats.txt"):
      if "Min" in item:
        self.min_depth =str(int(float(item.strip()[5:])))
    print self.min_depth
    os.system("beta_diversity_through_plots.py -f -i " + self.out + "/otus/otu_table.biom -m " + self.map + " -o " + self.out + "/bdiv -t " + self.out + "/otus/rep_set.tre -e " + self.min_depth)

For complete information about the qiime pipeline, please refer to the manual located at /mnt/grl/brc/application/qiime_pipeline/documentation and /mnt/grl/brc/application/qiime_pipeline/examples.
